eliyahu ניהול  29 בספט׳ 2020, 23:45
API גישת מפתחים למערכות
הAPI המפורסם כאן נותן אפשרות לניהול המערכת שלא דרך אתר הניהול אלא בצורה עצמאית. הדבר מיועד עבור מפתחים המעוניינים להתממשק בצורה אוטומטית עם המערכת. אין כל קשר בין הAPI הזה למודול API

בכל פעולה בAPI יש 2 חלקים. חלק ראשון - שליחת בקשה לשרת. חלק שני - תשובה מהשרת.

חלק ראשון: שליחת בקשה לשרת
שימו לב: לאחר השידרוג ניתן לשלוח בקשות לכל השרתים עם הכתובת הרגילה
למערכות בשרתי ymt ו-yemot וכן ל:ymta ו-ymtb כתובת ה-URL למשלוח הבקשה היא

https://www.call2all.co.il/ym/api/
למערכות בשרתי ymta ו-ymtb ניתן לשלוח בקשות גם לכתובת ה-URL :

https://private.call2all.co.il/ym/api/
בדוגמאות להלן הכתובת הבסיסית תושמט ובמקומה יופיע {url}$

את כל הבקשות (למעט העלאת קבצים) ניתן לשלוח בGET או בPOST
בבקשות POST ניתן לשלוח את הפרמטרים כJSON בתוך הbody. כמובן יש לציין בפניה Content-Type=application/json.

הבקשה מורכבת מ2 חלקים. חלק 1 פקודה חלק 2 פרמטרים.

לדוגמה: הפקודה להורדת קובץ היא DownloadFile והפרמטרים הנדרשים הם token path
במקרה כזה הבקשה בGET תראה כך:

${url}DownloadFile?token=${token}&path=${path}
ובצורה פשוטה יותר
https://www.call2all.co.il/ym/api/DownloadFile?token=077000000:1234&path=ivr2:/1/1/000.wav
בהמשך נביא את כל הפקודות הקיימות.

חלק שני: התשובה מהשרת
כל התשובות מהשרת (למעט הורדת קבצים) מקודדות בפורמט JSON וכוללות את המידע בנוגע לבקשה. בהמשך נביא את סוגי התשובות הקיימות עבור כל בקשה.

בנוסף, בכל תשובה יכללו המאפיינים הבאים:
yemotAPIVersion – גרסת הAPI הנוכחית (עשוי לשמש לאיתור בעיות תאימות עם גרסאות עתידיות)
responseStatus – מידע אודות הפעולה המבוקשת. אם הפעולה המבוקשת הושלמה בהצלחה, הערך יהיה OK אם הפעולה נכשלה, הערך יהיה ERROR ערך FORBIDDEN פירושו שהבקשה הייתה אסורה על ידי השרת, ערך EXCEPTION פירושו שהבקשה גרמה לחריג בשרת.
מאפיינים נוספים הנשלחים בחלק מהבקשות
message - הסבר על הפעולה שבוצעה או הסבר על השגיאה.
messageCode - קוד שגיאה. להלן יובאו כל סוגי הקודים הקיימים. אם במקום קוד שגיאה התקבל הערך null אירעה שגיאה כללית.

דוגמה לתשובה מהשרת עם הודעת שגיאה:

{
"yemotAPIVersion": "1",
"responseStatus": "ERROR",
"message": "Username or password is incorrect",
"messageCode": 1
}
בדוגמה זו, גירסת הAPI היא 1, הפעולה נכשלה, הסבר על השגיאה זמין במאפיין 'message' קוד השגיאה הוא 1.

הפונקציות האפשריות בממשק הAPI:
בגדול כמעט כל הדברים שאפשר לעשות דרך האתר אפשר גם בAPI (הפעלת קמפיינים שינוי שלוחות ניהול קבצים ועוד)

במדריך זה נחלק את האפשרויות ל3 חלקים.
חלק 1 התחברות למערכת והגדרות כלליות - שינוי סיסמה העברת יחידות עדכון פרטי משתמש ועוד
חלק 2 ניהול קמפיינים - הגדרת קמפיינים, הפעלת קמפיין עדכון מספרים ועוד.
חלק 3 מערכת תוכן - ניהול הקבצים והשלוחות במערכת.

חלק 1 התחברות למערכת והגדרות כלליות
התחברות-Login
התנתקות-Logout
פרטי המערכת-GetSession
שינוי סיסמת ניהול-SetPassword
עדכון פרטי משתמש-SetCustomerDetails
קבלת רשימת חיובי יחידות-GetTransactions
העברת יחידות-TransferUnits
קבלת רשימת שיחות נכנסות-GetIncomingCalls
העלאת קובץ-UploadFile
הורדת קובץ-DownloadFile

חלק 2 ניהול קמפיינים
קבלת מצב כל תבניות הקמפיינים-GetTemplates
עדכון תבנית קמפיין-UpdateTemplate
העלאת והורדת קבצי שמע לקמפיין
ניהול קבצי שמע בקמפיין (העתקה העברה או מחיקה)
יצירת תבנית קמפיין חדשה-CreateTemplate
מחיקת תבנית קמפיין-DeleteTemplate
הצגת המספרים שברשימת התפוצה-GetTemplateEntries
עדכון מספר בודד ברשימת תפוצה-UpdateTemplateEntry
עדכון סטטוס או מחיקה של מספרים מרשימת התפוצה-UpdateTemplateEntries
מחיקת כל המספרים מרשימת התפוצה-ClearTemplateEntries
העלאת קובץ טקסט והפיכתו לרשימת טלפונים לתבנית קמפיין-UploadPhoneList
הפעלת קמפיין-RunCampaign
מצב הקמפיין-GetCampaignStatus
הורדת דו"ח קמפיין-DownloadCampaignReport
קבלת קמפיינים פעילים-GetActiveCampaigns
ביצוע פעולות בקמפיינים פעילים-CampaignAction
יצירת קמפיין מתוזמן-ScheduleCampaign
קבלת קמפיינים מתוזמנים-GetScheduledCampaigns
מחיקת קמפיין מתוזמן-DeleteScheduledCampaign

חלק 3 מערכת תוכן
קבלת מידע מלא על השלוחה-GetIVR2Dir
קבלת מידע כללי על השלוחה
קבלת רשימת קבצים שבשלוחה-GetIvrTree
ניהול קבצים (שינוי שם, העתקה, העברה ומחיקה)-FileAction
העלאת קבצים- ראה ערך UploadFile
הורדת קבצים - ראה ערך DownloadFile
קבלת תוכן קובץ טקסט-GetTextFile
העלאת טקסט לקובץ-UploadTextFile
עדכון סוג שלוחה-UpdateExtension
הכוונת שיחה - העברת מאזין באפשרות הראשונה לשלוחה אחרת או לניתוק - CallAction
ניהול חדרי ועידה
שינוי השפה בערוץ
קבלת סיכום דקות נכנסות למערכת לפי טווח תאריכים
קבלת לוג סמסים יוצאים
פעולות הנוגעות באבטחה של המערכת. צפיה בלוג התחברויות, ניתוק סשנים
הפעלת צינתוק
בדיקה האם קובץ קיים
שליחת סמס
הקמת שיחת גישור
קבלת מידע בזמן אמת על שלוחת תור
קבלת מידע על המערכת
שליחת פקס
מערכת תזמון משימות
הוספה ואימות של זיהוי ספיישל
שליחת קמפיין הודעת TTS
הפקת דוח מקובץ ymgr
פירוט תנועות ביחידות סמסים
בדיקה האם תיקייה קיימת
חשבונות ומערכת sip

 10 
Eeliyahu ניהול  30 בספט׳ 2020, 10:55
התחברות

הסבר: בכל הבקשות הנשלחות לשרת יש צורך בפרמטר token שמשמש כקוד התחברות למערכת

הפקודה היא -Login

הפרמטרים הנדרשים:

פרמטר	תיאור / הערות
username	מספר מערכת
password	סיסמת הניהול של המערכת
מאפייני תגובת השרת:

מאפיין	ערך	הערה
token	טוקן	הטוקן שנוצר יפוג לאחר 60 דקות אם לא תתבצע שיחת API עם הטוקן. כמו כן, כל עוד הטוקן תקף יש להשתמש בו ולהימנע מבקשת התחברות נוספת
שימו לב!
ישנה דרך נוספת ליצירת טוקן ללא צורך בבקשת Login
בפרמטר token יש לרשום username:password

לדוגמה:

${url}<WebServiceName>?token=${username}:${password}
 7 
Eeliyahu ניהול  30 בספט׳ 2020, 11:03
התנתקות
מחיקת הטוקן שהתקבל בהתחברות

הפקודה היא - Logout

הפרמטרים הנדרשים:

פרמטר	תיאור / הערות
token	טוקן
אין מאפיינים מיוחדים בתגובת השרת

 5 
Eeliyahu ניהול  30 בספט׳ 2020, 11:20
קבלת פרטי המערכת

הפקודה היא - GetSession

הפרמטרים הנדרשים:

פרמטר	תיאור / הערות
token	טוקן
מאפייני תגובת השרת:

מאפיין	סוג	ערך
name		שם לקוח
unitsExpireDate	string	תאריך תפוגה של היחידות
email		כתובת אימייל
organization		שם ארגון
contactName		שם איש קשר
phones		טלפון
invoiceName		חשבונית על שם
invoiceAddress		כתובת למשלוח חשבונית
fax		פקס
accessPassword		סיסמת גישה למערכת
units	double	כמות היחידות שבמערכת
recordPassword		סיסמת הקלטות
creditFile		שם משווק
username	string	מספר המערכת
 5 
Eeliyahu ניהול  30 בספט׳ 2020, 12:54
שינוי סיסמת ניהול

הפקודה היא - SetPassword

הפרמטרים הנדרשים:

פרמטר	תיאור / הערות
token	טוקן
password	סיסמת הניהול הנוכחית
newPassword	סיסמה חדשה
אין מאפיינים מיוחדים בתגובת השרת

 5 
Eeliyahu ניהול  2 באוק׳ 2020, 1:05
עדכון פרטי משתמש

הערה: הפקודה מוחקת את פרטי המשתמש המעודכנים במערכת.

הפקודה היא - SetCustomerDetails

הפרמטרים הנדרשים:

פרמטר	תיאור
token	טוקן פרמטר חובה
name	שם לקוח
email	כתובת דוא"ל
organization	שם ארגון
contactName	שם איש קשר
phones	טלפון
invoiceName	חשבונית על שם
invoiceAddress	כתובת למשלוח חשבונית
fax	פקס
accessPassword	סיסמת גישה
recordPassword	סיסמת הקלטות
אין מאפיינים מיוחדים בתגובת השרת

 5 
Eeliyahu ניהול  2 באוק׳ 2020, 2:08
קבלת רשימת חיובי יחידות
היסטוריה של תנועת יחידות במערכת (כולל דוחות קמפיינים שהסתיימו)

הפקודה היא - GetTransactions

הפרמטרים הנדרשים:

פרמטר	תיאור	הערות
token	טוקן	חובה
from	מאיזה תנועה להציג	רשות
limit	מספר מרבי של תנועות שיש לכלול	רשות
filter	סינון תוצאות לפי סוג פעולה	campaigns עבור חיובי קמפיינים
מאפייני תגובת השרת:

מאפיין	סוג	ערך
transactions	array	מערך אובייקטים (ראה "תבנית אובייקט תנועה" להלן)
totalCount	int	מספר כולל של תנועת יחידות
תבנית אובייקט תנועה

מאפיין	סוג	ערך
id	int	מזהה תנועה ייחודי
transactionTime	string	תאריך ושעה (פורמט: yyyy-MM-dd HH:mm:ss)
amount	double	סכום היחידות
description	string	תיאור העסקה. ראה להלן מילות מפתח מיוחדות
who	string	בוצע על ידי:   1) כתובת IP במידה והפעולה בוצעה דרך אתר האינטרנט.   2) מספר טלפון במידה והפעולה בוצעה דרך הטלפון.   3) ADMIN במידה והפעולה בוצעה על ידי שירות הלקוחות.   4) TRANSFER במקרה של העברת יחידות.   5) expire במקרה של פג תוקף.
newBalance	double	כמות יחידות מחודשת לאחר התנועה
expireDate	string	במידה וקיים תאריך תפוגה חדש הוא יופיע בערך זה (בפורמט: yyyy-MM-dd). במידה ולא קיים יתקבל הערך null
campaignId	string	במידה והתנועה שבוצעה היתה הפעלת קמפיין יופיע בערך זה מזהה הקמפיין המתאים (משמש להורדת דוח הקמפיין). במידה ולא, יתקבל הערך null
מילות מפתח מיחדות למאפיין description שניתן להשתמש בהן כדי לזהות סוגי פעולות

תיאור המתחיל ב	פירושו
Start-	חיוב עבור הפעלת קמפיין
transfer to	חיוב עבור העברת יחידות למערכת אחרת
transfer from	יחידות שנוספו בהעברה ממערכת אחרת
Units expired	פג תוקף היחידות
 4 
Eeliyahu ניהול  4 באוק׳ 2020, 18:30
העברת יחידות
העברת יחידות למערכת אחרת

הפקודה היא - TransferUnits

הפרמטרים הנדרשים:

פרמטר	תיאור/הערות
token	טוקן
destination	מספר מערכת להעברה
amount	כמות יחידות להעברה
מאפייני תגובת השרת במקרה שהעברה בוצעה בהצלחה:

מאפיין	סוג	ערך
destination	string	מערכת היעד אליה בוצעה ההעברה
amount	double	הסכום שהועבר
newBalance	double	יתרת היחידות במערכת המקור לאחר ביצוע ההעברה
במקרה של שגיאה בביצוע ההעברה ההודעות והקודים האפשריים הם כדלקמן:

messageCode	message	הסבר
111	Bad destination	יעד להעברה לא חוקי: המערכת אינה קיימת או שאינה מורשית לקבל יחידות ממערכת זו
112	Bad amount	סכום היחידות להעברה אינו חוקי
113	Not enough balance	יתרת היחידות שבמערכת אינה מאפשרת את ביצוע ההעברה
 7 
Eeliyahu ניהול  4 באוק׳ 2020, 19:02
קבלת רשימת שיחות הפעילות במערכת

הפקודה היא - GetIncomingCalls

הפרמטרים הנדרשים:

פרמטר	תיאור/הערות
token	טוקן
מאפייני תגובת השרת:

מאפיין	סוג	הסבר
calls	array	מערך אובייקטים (ראה "תבנית אובייקט שיחה" להלן)
callsCount	int	מספר כולל של שיחות במערכת
תבנית אובייקט שיחה

מאפיין	ערך
did	מספר מחוייג
callerIdNum	מספר מחייג (כולל ערכים של ID val_name במידה וקיים במערכת)
duration	משך זמן שיחה - בשניות
transferFrom	האם השיחה הועברה ממערכת אחרת. במידה וכן יופיע הערך מועבר במידה ולא יפיע הערך null
id	מזהה ייחודי לאורך השיחה
path	מספר שלוחה (כולל תיאור שלוחה ומספר קובץ במידה וקיים)

